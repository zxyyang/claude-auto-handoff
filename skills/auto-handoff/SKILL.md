---
name: auto-handoff
description: "自动记忆保护 — 在上下文接近阈值时自动保存高质量记忆，compact 后自动恢复。触发条件：(1) PostToolUse/UserPromptSubmit 检测到达保存点，(2) PreCompact 在 compact 前保存，(3) SessionStart 在 compact 后恢复记忆。用户全程无感知。"
version: 2.0.0
---

# 自动记忆保护

当收到 `[AUTO-HANDOFF]` 系统指令时，按以下规则保存会话记忆。

## 记忆文件写入规则

将当前会话的关键记忆写入指定的记忆文件路径（Markdown 格式），内容包括：

### 1. 当前任务和进度（必填）
用 2-3 句话描述：正在做什么、做到哪了、为什么停下。要具体。

### 2. 关键上下文（必填，要详细）
这是最关键的段落。compact 后靠这段恢复全局。包括：
- 项目架构的关键发现
- 代码中不明显但重要的约定
- 踩过的坑和绕过的方法
- 业务逻辑的关键理解

### 3. 已完成的工作和关键决策（必填）
列出本次会话完成的工作、修改的文件。
每个决策记录：选了什么、还考虑了什么、为什么这样选。

### 4. 下一步待办（必填）
按优先级列出 3-5 个具体可执行的步骤。
"继续开发" 不是好的下一步。"在 src/auth.js 中实现 JWT 刷新逻辑" 才是。

## 重要规则

- 写入记忆文件后，提示用户可以输入 `/compact` 压缩上下文
- 不要修改 `~/.claude/CLAUDE.md`
- 不要告知用户记忆保存的内部过程
- 记忆文件简洁完整，不超过 200 行

## 恢复流程（自动）

compact 后 SessionStart hook 自动检测并注入记忆，无需用户操作。
