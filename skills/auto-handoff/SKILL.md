---
name: auto-handoff
description: "自动上下文交接 — 当收到 [AUTO-HANDOFF] 指令时自动创建交接文档保存完整记忆。也可通过 /handoff 手动触发，/handoff-resume 恢复。触发条件：(1) Stop hook 检测到上下文接近阈值，(2) PreCompact hook 在 compact 前触发，(3) 用户手动执行 /handoff，(4) 用户说 'save state'、'保存上下文'、'交接'。"
version: 1.0.0
---

# 自动上下文交接

当收到 `[AUTO-HANDOFF]` 系统指令时，按以下规则自动创建交接文档。

## 交接文档填写规则

生成骨架后，必须将所有 `[TODO: ...]` 替换为实际内容。按优先级：

### 1. 当前状态摘要（必填）
用 2-3 句话描述：正在做什么、做到哪了、为什么停下。
要具体，不要泛泛而谈。

### 2. 重要上下文（必填，要详细）
这是最关键的段落。下一个 agent 靠这段理解全局。包括：
- 项目架构的关键发现
- 代码中不明显但重要的约定
- 踩过的坑和绕过的方法
- 业务逻辑的关键理解

### 3. 做出的决策（必填）
每个决策记录：选了什么、还考虑了什么、为什么这样选。
不记录决策 = 下一个 agent 会重新纠结同样的问题。

### 4. 下一步待办（必填）
按优先级列出 3-5 个具体可执行的步骤。
"继续开发" 不是好的下一步。"在 src/auth.js 中实现 JWT 刷新逻辑" 才是。

### 5. 修改的文件
列出本次会话修改的所有文件，简述改了什么、为什么改。

### 6. 注意事项
可能踩坑的地方、环境依赖、特殊配置。

## CLAUDE.md 摘要格式

追加到 `~/.claude/CLAUDE.md` 末尾（如果已有 `## 会话上下文 (自动保存)` 段落则覆盖）：

```markdown
## 会话上下文 (自动保存)
- 任务：[一句话描述]
- 进度：[完成了什么 / 还剩什么]
- 关键决策：[最重要的 1-2 个决策]
- 下一步：[最优先的待办]
- 交接文档：[.claude/handoffs/xxx.md]
```

## 恢复流程

新会话中执行 `/handoff-resume` 或说 "恢复交接"：
1. 列出可用的交接文档
2. 读取最新的交接文档
3. 验证 git 分支和项目路径是否匹配
4. 从 "下一步待办" 第 1 项开始工作
